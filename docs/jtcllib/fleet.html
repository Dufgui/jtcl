<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Nov 16, 2013 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
    <title></title>
    <style type="text/css" media="all">
      @import url("../../css/maven-base.css");
      @import url("../../css/maven-theme.css");
      @import url("../../css/site.css");
    </style>
    <link rel="stylesheet" href="../../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20131116" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                                      <a href="../.././" id="bannerLeft">
                                                <img src="../../images/jtcl-horz-med.png" alt="JTcl" />
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
        
                <div class="xleft">
        <span id="publishDate">Last Published: 2013-11-16</span>
                  &nbsp;| <span id="projectVersion">Version: 2.6.0</span>
                      </div>
            <div class="xright">                    <a href="http://www.tcl.tk/" class="externalLink" title="Tcl">Tcl</a>
            |
                        <a href="http://www.oracle.com/technetwork/java/index.html" class="externalLink" title="Java">Java</a>
              
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
        
                                <h5>JTcl Links</h5>
                  <ul>
                  <li class="none">
                          <a href="https://github.com/jtcl-project/jtcl/releases" class="externalLink" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="../../news.html" title="News">News</a>
            </li>
                  <li class="none">
                          <a href="../../gettingstarted.html" title="Getting Started">Getting Started</a>
            </li>
                  <li class="none">
                          <a href="../../docs/index.html" title="Documentation">Documentation</a>
            </li>
                  <li class="none">
                          <a href="../../faq.html" title="FAQ">FAQ</a>
            </li>
                  <li class="none">
                          <a href="../../projects.html" title="Projects Using JTcl">Projects Using JTcl</a>
            </li>
                  <li class="none">
                          <a href="https://github.com/jtcl-project/jtcl/issues" class="externalLink" title="Bugs">Bugs</a>
            </li>
                  <li class="none">
                          <a href="http://kenai.com/projects/jtcl/lists" class="externalLink" title="Mailing Lists">Mailing Lists</a>
            </li>
                  <li class="none">
                          <a href="https://github.com/jtcl-project/jtcl" class="externalLink" title="Source Code">Source Code</a>
            </li>
                  <li class="none">
                          <a href="../.././" title="Project Page">Project Page</a>
            </li>
                  <li class="none">
                          <a href="../../licenses.html" title="License">License</a>
            </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" />
      </a>
                   
        
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Fleet <a name="Fleet"></a></h2><!-- ~~ --><p>Fleet is a simple concurrent programming tool for JTcl. This is a very early release of Fleet and is mostly intended for experimentation. Fleet consists of Java code that implements the &quot;fleet&quot; command and a set of Tcl procedures in the &quot;::fleet&quot; namespace that are used to initialize a fleet and manage message flow to the fleet members. The low level fleet code can be used in many ways. The procs in the ::fleet namespace provide one method to manage concurrent calculations.</p><div class="section"><h3>Usage<a name="Usage"></a></h3><p>Load the <b>fleet</b> Java extension in Tcl source files:</p><div class="source"><pre>    package require fleet</pre></div></div><div class="section"><h3>fleet create<a name="fleet_create"></a></h3><p>::fleet create -name <i>fleet-name</i> </p><p>::fleet create creates a new fleet and a new Tcl level command for manipulating fleets.</p><div class="section"><h4>Arguments<a name="Arguments"></a></h4><ul><li>-name fleetName<p>The name given to the fleet and the name of the Tcl level command that will be created. If this optional argument is not included the fleet will be named fleetN where N is an integer starting at 0 and incrementing for each fleet created.</p></li></ul></div></div><div class="section"><h3>fleetName member<a name="fleetName_member"></a></h3><p>::fleetName member -name <i>fleet-name</i></p><p>::fleetName member creates a new member of the fleet.</p><div class="section"><h4>Arguments<a name="Arguments"></a></h4><ul><li>-name memberName<p>The name given to the new member of the fleet If this optional argument is not included the member will be named memberN where N is an integer starting at 0 and incrementing for each member created.</p></li></ul><p>Example:</p><div class="source"><pre>  set fl [fleet create -name webfleet]
  set m1 [$fl member -name web1]</pre></div></div></div><div class="section"><h3>fleetName tell<a name="fleetName_tell"></a></h3><p>::fleetName tell memberName msg -reply <i>replyCmd</i> -var <i>doneVar</i></p><p>::fleetName tell sends a message representing a script to be executed in the fleet member with name memberName.</p><div class="section"><h4>Arguments<a name="Arguments"></a></h4><ul><li>memberName<p>The name of the member to send the message to. If memberName is &quot;*&quot; then the same message is sent to all members of the fleet.</p></li><li>msg<p>A Tcl script that will be executed in by the member in its own interpreter and thread.</p></li><li>-reply replyCmd<p>A command that will be executed in the Tcl interpreter that sent the message when the command has finished executing.</p></li><li>-var varName<p>A variable that will be set in the Tcl interpreter that sent the message when the command has finished executing.</p></li><li>Both -reply and -var are optional, but only one of them should be set.</li></ul></div><div class="section"><h4>Result<a name="Result"></a></h4><p>The argument to the procedure specified by a -reply argument, and the variable set with the -var argument, are both Tcl dictionary values with the following key/value pairs:</p><ul><li>status<p>OK or FAIL depending on the return code of the procedure executed</p></li><li>fleet<p>the name of the fleet that the command was executed in</p></li><li>member<p>the name of the fleet member that executed the command</p></li><li>value<p>the result of executing the command</p></li><li>count<p>the number of items in the members execution key when this result was returned</p></li></ul><p>Example:</p><div class="source"><pre>  set msg {set x [expr {sqrt(3.0)}]}
  $fl tell $m1 $msg -reply doneCmd </pre></div></div></div><div class="section"><h3>fleetName forget<a name="fleetName_forget"></a></h3><p>::fleetName forget memberName </p><p>::fleetName forget sends a message telling member to forget (remove from its queue) all messages that haven't yet been executed) </p><div class="section"><h4>Arguments<a name="Arguments"></a></h4><ul><li>memberName</li></ul></div></div><div class="section"><h3>fleetName count<a name="fleetName_count"></a></h3><p>::fleetName count -messages memberName</p><p>::fleetName count returns a count of items in the fleet. What items are counted depend on the specified arguments.</p><div class="section"><h4>Arguments<a name="Arguments"></a></h4><ul><li>-messages memberName<p>Return a count of the number of messages in the specified members queue. As the member might be continuously acting on, and removing messages from the queue, this is only an estimate.</p></li></ul></div></div><div class="section"><h3>fleetName destroy<a name="fleetName_destroy"></a></h3><p>::fleetName destroy ?memberName?</p><p>::fleetName destroy destroys a member (if memberName is specified) or the entire fleet if no memberName argument is present. The destroy message is placed on the members input queue and will not be acted upon until all messages already in the queue are acted upon. Use the forget command to clear the queue if you want the destroy action to happen as soon as the the current message (if any) is done being acted upon.</p><div class="section"><h4>Arguments<a name="Arguments"></a></h4><ul><li>memberName<p>The name of the member to destroy. If not specified the whole fleet is destroyed.</p></li></ul></div></div><div class="section"><h3>::fleet::initFleet<a name="a::fleet::initFleet"></a></h3><p>set fleet [::fleet::initFleet 2 initScript]</p><p>This procedure creates a fleet and an associated namespace with parameters set to default values and initializes the fleet members</p><div class="section"><h4>Arguments<a name="Arguments"></a></h4><ul><li>nMembers<p>The number of members to create for the fleet.</p></li><li>script<p>A script to run in each member of the fleet when the member is first created</p></li></ul></div></div><div class="section"><h3>::fleet::configure<a name="a::fleet::configure"></a></h3><p>::fleet::configure $fleet -messageProc sendMessage -calcProc accumulateResults -doneProc reportResults</p><p>This procedure creates a fleet and an associated namespace with parameters set to default values and initializes the fleet members</p><div class="section"><h4>Arguments<a name="Arguments"></a></h4><ul><li>fleetName<p>The name of the fleet to configure</p></li><li>-messageProc<p>The procedure used to send messages to fleet members. Defaults to &quot;messageProc&quot;</p></li><li>-calcProc<p>The procedure that processes the result value sent back from each member. Defaults to &quot;calcProc&quot;</p></li><li>-doneProc<p>The procedure called when all messages have been processed. Defaults to &quot;reportProc&quot;</p></li><li>-nMembers<p>The number of members in fleet (normally set with initFleet command)</p></li><li>-lowWater<p>If number of items in a fleet members queue falls below this level send more messages. Defaults to 50.</p></li><li>-highWater<p>When sending messages send a count that will bring the total in members queue up to the highWater value. Defaults to 100.</p></li><li>-nMessages<p>The total number of messages that need to be send to complete the calculation currently be performed by fleet. Defaults to 10000.</p></li><li>-nResults<p>The number of results that have been returned by the fleet members. Initialized to 0</p></li><li>-messageNum<p>The number of messages that have been sent to the fleet members. Initialized to 0</p></li></ul></div></div><div class="section"><h3>::fleet::sendMessages<a name="a::fleet::sendMessages"></a></h3><p>::fleet::sendMessages $fleet</p><p>Start sending messages to the specified fleet.</p><div class="section"><h4>Arguments<a name="Arguments"></a></h4><ul><li>fleetName<p>The name of the fleet to send messages to.</p></li></ul></div></div><div class="section"><h3>::fleet::jproc<a name="a::fleet::jproc"></a></h3><p>eval ::fleet::jproc $fleet $procScript</p><p>Send a script representing a Java method to be compiled (using Hyde)</p><div class="section"><h4>Arguments<a name="Arguments"></a></h4><ul><li>fleetName<p>The name of the fleet generate the method in.</p></li><li>script<p>The script to be compiled into a Java method.</p></li></ul></div></div><div class="section"><h3>::fleet::reset<a name="a::fleet::reset"></a></h3><p>::fleet::reset $fleet</p><p>Reset the message counts for the fleet and its members so a new calculation can be begun.</p><div class="section"><h4>Arguments<a name="Arguments"></a></h4><ul><li>fleetName<p>The name of the fleet to reset.</p></li></ul></div></div><div class="section"><h3>Example<a name="Example"></a></h3><div class="source"><pre>proc readyCmd {args} {
   puts &quot;done $args&quot;
}

proc checkReadyVar {varName varElem mode} {
   upvar #0 $varName var
   puts $var($varElem)
}

package require java
package require fleet

set script {
    proc count {n} {
        set x 0.0
        for {set i 0} {$i &lt;$n} {incr i} {
           set x [expr {$x+rand()}]
        }
        return $x
    }
}
set fl1 [fleet create]
set m1 [$fl1 member]
set m2 [$fl1 member]

$fl1 tell $m1 $script -reply readyCmd
$fl1 tell $m2 $script -reply readyCmd
for {set i 0} {$i &lt; 10} {incr i} {
    puts $i
    $fl1 tell $m1 &quot;count 100000&quot; -reply readyCmd
}
for {set i 0} {$i &lt; 10} {incr i} {
    puts $i
    $fl1 tell $m2 &quot;count 100000&quot; -var readyVar($i)
}
trace add variable  readyVar write checkReadyVar
#$fl1 destroy $m1
#$fl1 destroy $m2
vwait done</pre></div></div><div class="section"><h3>Example<a name="Example"></a></h3><div class="source"><pre>
## Calculate pi using concurrent program
## Compare to example in the Akka &quot;getting started&quot; documentation (http://akka.io)

package require hyde
package require fleet

proc sendMessage {fleet member messageNum} {
    set nElems 10000
    $fleet tell $member &quot;calcPiFor $messageNum $nElems&quot;  -reply ::fleet::processReply
}

proc accumulateResults {value} {
    global acc
    set acc [expr {$value+$acc}]
}

proc reportResults {} {
    global acc done
    puts &quot;pi is $acc&quot;
    set done $acc
}


set procScript {
    double calcPiFor {int start int nElem} {
        double acc = 0.0;
        int iStart = start*nElem;
        int iEnd = (start+1)*nElem-1;
        for (int i=iStart;i&lt;=iEnd;i++) {
            acc += 4.0 * (1 - (i % 2) * 2) / (2 * i + 1);
        }
        return acc;
    }
}

set initScript &quot;package require java&quot;
set fleet [::fleet::initFleet 2 $initScript]
eval ::fleet::jproc $fleet $procScript
::fleet::configure $fleet -messageProc sendMessage -calcProc accumulateResults -doneProc reportResults
::fleet::configure $fleet -nMessages 10000 -highWater 500

set acc 0.0
::fleet::sendMessages $fleet

vwait done
</pre></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2013.
          All Rights Reserved.      
        
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
